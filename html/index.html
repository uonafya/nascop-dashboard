<!DOCTYPE html>
<html dir="ltr" lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <!-- Tell the browser to be responsive to screen width -->
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <!-- Favicon icon -->
        <link rel="icon" type="image/png" sizes="16x16" href="../assets/images/nascop-logo.png" />
        <title>
           Home | Nascop Dashboard
        </title>
        <!-- Custom CSS -->
        <link href="../assets/libs/select2/select2.min.css" rel="stylesheet" />
        
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/pikaday/css/pikaday.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highcharts/8.1.1/css/highcharts.min.css">
        <link href="../dist/css/style.min.css" rel="stylesheet" />
        <link href="../dist/css/custom.css" rel="stylesheet" />
        <link href="../dist/css/main.css" rel="stylesheet" />
        
    </head>

    <body onload="renderAll(); window.fetchData();">
        <div class="preloader">
            <div class="lds-ripple">
                <div class="lds-pos"></div>
                <div class="lds-pos"></div>
            </div>
        </div>
        <div id="main-wrapper">
            <header class="topbar" data-navbarbg="skin5" id="header_target"></header>
            <aside class="left-sidebar" data-sidebarbg="skin5">
                <div class="scroll-sidebar">
                    <nav class="sidebar-nav" id="nav_target"></nav>
                </div>
            </aside>
            <div class="page-wrapper">
                <div class="page-breadcrumb">
                    <div class="row">
                        <div class="col-12 d-flex no-block align-items-center" id="filter_target">
                            <!-- <small class="text-bold">Filter:</small> -->
                                <!-- <div class="col-md-12 col-sm-12 col-xs-12">
                                </div> -->
                        </div>
                    </div>
                </div>
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12 p-0" id="status_target"> </div>
                        <div class="col-md-12 p-0" id="loading_target"> </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6" >
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title">Target Vs Results</h4>
                                    <div class="graph" id="anc_target">
                                        <p class="card-text"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6" >
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title">Proportion of expectant women attending 1st ANC </h4>
                                    <div class="graph" id="anc">
                                        <p class="card-text"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                    <div class="row">
                        <div class="col-md-6" >
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title">Target Vs Results</h4>
                                    <div class="graph" id="syphilis_target">
                                        <p class="card-text"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6" >
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title"> Proportion of pregnant women tested for Syphilis </h4>
                                    <div class="graph" id="syphilis">
                                        <p class="card-text"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                    <div class="row">
                        <div class="col-md-6" >
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title">Target Vs Results</h4>
                                    <div class="graph" id="haart_target">
                                        <p class="card-text"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6" >
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title"> Proportion of HIV infected pregnant and breastfeeding women on HAART </h4>
                                    <div class="graph" id="haart">
                                        <p class="card-text"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                    <div class="row">
                        <div class="col-md-6" >
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title">Target Vs Results</h4>
                                    <div class="graph" id="hei_target">
                                        <p class="card-text"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6" >
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title"> Proportion of HIV Exposed Infants on Infant ARV Prophylaxis</h4>
                                    <div class="graph" id="hei">
                                        <p class="card-text"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                    <div class="row">
                        <div class="col-md-6" >
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title">Target Vs Results</h4>
                                    <div class="graph" id="pcr_target">
                                        <p class="card-text"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6" >
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title"> Percentage  of HIV Exposed infants receiving an initial PCR within 2 months of birth  </h4>
                                    <div class="graph" id="pcr">
                                        <p class="card-text"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                    
 
                                            
                       
                    </div>
                </div>
            </div>
        </div>
        <div id="footer_target" class="p-0 m-0 w-100"></div>
        
        <script src="../assets/libs/jquery/dist/jquery.min.js"></script>
        <script src="../assets/libs/select2/select2.min.js"></script>
        <script src="../assets/libs/popper.js/dist/umd/popper.min.js"></script>
        <script src="../assets/libs/bootstrap/dist/js/bootstrap.min.js"></script>
        <script src="../assets/libs/perfect-scrollbar/dist/perfect-scrollbar.jquery.min.js"></script>
        <script src="../dist/js/sidebarmenu.js"></script>
        <script src="../dist/js/custom.js"></script>

        <!-- *********** <WeekPicker ************** -->
        <script src="https://cdn.jsdelivr.net/npm/moment@2.26.0/moment.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/pikaday/pikaday.js"></script>
        <script src="../dist/js/weekpicker.js"></script>
        <!-- *********** WeekPicker/> ************** -->
        
        <!-- *********** <Highcharts ************** -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highcharts/8.1.1/es-modules/highcharts.src.min.js"></script>
		<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/highcharts/8.1.0/highcharts.js"></script> -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/highcharts/8.1.1/modules/exporting.min.js"></script>		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/highcharts/8.1.1/modules/export-data.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/highcharts/8.1.1/modules/accessibility.min.js"></script>
        <!-- *********** Highcharts/> ************** -->




        <!-- TEMPLATING -->
        <script src="../dist/js/templates/mustache.js"></script>

            <!-- templates -->
            <!-- <script id="header_template" type="x-tmpl-mustache">
                //html here
            </script> -->
            <script src="../dist/js/templates/components/footer.js"></script>
            <script src="../dist/js/templates/components/header.js"></script>
            <script src="../dist/js/templates/components/nav.js"></script>
            <script src="../dist/js/templates/components/filter.js"></script>
            <script src="../dist/js/templates/components/loading.js"></script>
            <script src="../dist/js/templates/components/status.js"></script>
            <!-- templates -->

            <!-- renders -->
            <script src="../dist/js/templates/renders.js"></script>
            <!-- renders -->

            <!-- render Fn -->
            <script>
                function renderAll() {
                    let page_title = {title: 'Priority Indicators'}
                    let page_filters = {
                        is_county:true, 
                        is_subcounty:false, 
                        is_ward:false, 
                        is_facility:false, 
                        is_period:true, 
                        is_period_range:true}
                    let is_loading = {is_loading: false}
                    let footer_yr = { yr: new Date().getFullYear()}
                    let page_status = {title: '', message: '', type: 'info', hidden: true} //type: info, success, danger

                    renderNav()
                    renderHeader(page_title)
                    renderFooter(footer_yr)
                    renderLoader(is_loading)
                    renderFilter(page_filters)
                    renderStatus(page_status)
                }
            </script>
            <!-- render Fn -->
        <!-- TEMPLATING -->


        <script src="../dist/js/_utils.js"></script>


        
        
        <!-- ++++++++++++++++++++++++ PAGE DATA LOGIC ++++++++++++++++++++++++ -->
        <script>
            window.fetchData = (prop) => {
               
                // let org_unit = window.sessionStorage.getItem('ess_ou') || "HfVjCurKxh2"
                let org_unit = "HfVjCurKxh2"
                if(prop && prop.ou){
                    org_unit = prop.ou
                }
                let prd = `LAST_12_MONTHS`
                if(prop && prop.pe){
                    prd = prop.pe
                }
                if(prop && prop.pe && prop.pe_to){
                    prd = dateRange(prop.pe, prop.pe_to)
                }
                console.log('prd = = = '+prd);

                let ouFilterType = window.sessionStorage.getItem("ouFilterType") || "national"
                var finalpe =prd.replace(/,/g, ';');
                if (finalpe == `LAST_YEAR`){
                    var yr = `LAST_YEAR`
                }else{
                    var yr = finalpe.substring(0,4)
                }
                

                // let data = fetchdata(ancascade)

                let attending_anc = `https://hiskenya.org/api/29/analytics.json?dimension=dx:pct05jgGcLt;f9vesk5d4IY&dimension=pe:${finalpe}&filter=ou:${org_unit}&displayProperty=NAME&outputIdScheme=UID`
                let attending_target = `https://hiskenya.org/api/29/analytics.json?dimension=dx:pct05jgGcLt;f9vesk5d4IY&filter=ou:${org_unit}&filter=pe:${finalpe}&displayProperty=NAME&outputIdScheme=UID`

                let syphilis = `https://hiskenya.org/api/29/analytics.json?dimension=dx:pct05jgGcLt;uvBuzBj0AbL&dimension=pe:${finalpe}&filter=ou:${org_unit}&displayProperty=NAME&outputIdScheme=UID`
                let syphilis_target = `https://hiskenya.org/api/29/analytics.json?dimension=dx:uvBuzBj0AbL;pct05jgGcLt&filter=ou:${org_unit}&filter=pe:${finalpe}&displayProperty=NAME`

                let haart = `https://hiskenya.org/api/29/analytics.json?dimension=dx:XBaEY6d5bzt;Hp2jBjAsu8U&dimension=pe:${finalpe}&filter=ou:${org_unit}&displayProperty=NAME&outputIdScheme=UID`
                let haart_target = `https://hiskenya.org/api/29/analytics.json?dimension=dx:XBaEY6d5bzt;Hp2jBjAsu8U&filter=ou:${org_unit}&filter=pe:${finalpe}&displayProperty=NAME&outputIdScheme=UID`
               
                let hei = `https://hiskenya.org/api/29/analytics.json?dimension=dx:XBaEY6d5bzt;LhVCexhVr4n&dimension=pe:${finalpe}&filter=ou:${org_unit}&displayProperty=NAME&outputIdScheme=UID`
                let hei_target = `https://hiskenya.org/api/29/analytics.json?dimension=dx:XBaEY6d5bzt;LhVCexhVr4n&filter=ou:${org_unit}&filter=pe:${finalpe}&displayProperty=NAME&outputIdScheme=UID`

                let pcr = `https://hiskenya.org/api/29/analytics.json?dimension=dx:XBaEY6d5bzt;UIok7l6W4nh&dimension=pe:${finalpe}&filter=ou:${org_unit}&displayProperty=NAME&outputIdScheme=UID`
                let pcr_target = `https://hiskenya.org/api/29/analytics.json?dimension=dx:XBaEY6d5bzt;UIok7l6W4nh&filter=ou:${org_unit}&filter=pe:${finalpe}&displayProperty=NAME&outputIdScheme=UID`

                
                getWomenAnc(attending_anc)
                getWomenAnc_target(attending_target)
                getSyphilis(syphilis)
                getSyphilis_target(syphilis_target)
                getHaart(haart)
                getHaart_target(haart_target)
                getHei(hei)
                getHei_target(hei_target)
                getPcr(pcr)
                getPcr_target(pcr_target)
               


        }


            function getWomenAnc(url){
                justFetch(url, {})
                .then(response => {
                    var cTitle = 'Proportion of expectant women attending 1st ANC '
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;   
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    var periodName = []
                    var dataRows = []
                    var stacking = ''
                    let dataToPlot = []

                    dataValues = Array.from(response.rows, r => r[3])
                    const { rows } = response
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const getDXName = (id) => {
                        return response.metaData.items[id].name
                    }
                    const toNumbers = arr => arr.map(Number);
                    // console.log(pe)

                    dx.map((d_x,ix)=>{
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        datapoint.data = []
                        datapoint.type = 'column'
                        let da_ta
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x && rw1[response.headers.findIndex(jk => jk.name == "pe")] == p_e) || [0,0,0,0,0]
                            datapoint.data.push(parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ]))
                        })
                        
                        if (datapoint.name.toLowerCase().split(" ").join("_").includes("estimated_number_of_pregnant_women")) {
                                datapoint.data.map(data=>{
                                    if(pe[0].length == 6){
                                    da_ta = parseInt((data /12).toFixed(0))
                                    }else{
                                    da_ta = parseInt((data).toFixed(0))
                                    }
                                    datapoint.data.push(da_ta)
                                })
                             let len = parseInt(datapoint.data.length)/2
                                datapoint.data.splice(0,len)
                            }
                        dataToPlot.push(datapoint)
                        
                        
                    })
                     
                    
                    var fperiodName = periodRange(periodName)
                    let den = dataToPlot.find(r=>r.name=="Estimated Number of Pregnant Women")?.data || 0
                    let num = dataToPlot.find(r=>r.name=="MOH 711 New ANC clients")?.data || 0
                    let Achieved =[]
                    num.map(dataa=>{
                        let f_archived = parseInt((dataa/den[0])*100)
                        Achieved.push(f_archived)
                    }) 
                    console.log(dataToPlot)
                    //  plotGraph(x_array, "Period", dataToPlot, "Proportions", "Proportion of IPTp missed opportunities referred to the Health Facility - "+response.metaData.items[response.metaData.dimensions.ou[0]].name, null, 'anc', "line", null)
                    drawSpines('anc', cTitle, periodName, fperiodName, curorg, dataToPlot, stacking,'', Achieved)

                });

            }

            function getWomenAnc_target(url){
                justFetch(url, {})
                .then(response => {
                    var cTitle = 'Proportion of expectant women attending 1st ANC '
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;   
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    var periodName = []
                    var dataRows = []
                    var stacking = ''
                    let dataToPlot = []
                    let finalData = []
                    finalData.name =[]
                    finalData.data = []
                    var color = ["#7cb5ec","#90ed7d","#434348"]

                    


                    dataValues = Array.from(response.rows, r => r[3])
                    const { rows } = response
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const getDXName = (id) => {
                        return response.metaData.items[id].name
                    }
                    const toNumbers = arr => arr.map(Number);
                    // console.log(pe)


                    dx.map((d_x,ix)=>{
                        
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x ) || [0,0,0,0,0]
                            datapoint.y = parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ])
                        })
                        
                        
                        
                        // if (datapoint.name.toLowerCase().split(" ").join("_").includes("estimated_number_of_pregnant_women")) {
                        //         datapoint.data.map(data=>{
                        //             let da_ta = parseInt((data /12).toFixed(0))
                        //             datapoint.data.push(da_ta)
                        //         })
                        //      let len = parseInt(datapoint.data.length)/2
                        //         datapoint.data.splice(0,len)
                        // //     }
                        //     console.log(datapoint)
                        dataToPlot.push(datapoint)

                        
                        
                    })
                   
                    var fperiodName = periodRange(periodName)
                    let len = response.metaData.dimensions.pe.length
                    let f_den
                    let len_1 =  pe[0].length
                    let den = dataToPlot.find(r=>r.name=="Estimated Number of Pregnant Women")?.y || 0
                    let num = dataToPlot.find(r=>r.name=="MOH 711 New ANC clients")?.y || 0
                    
                    if (len_1 == 6){
                         f_den = parseInt(((len/12)*den).toFixed(0))
                    }else if(len_1 == 4){
                        f_den = parseInt((den).toFixed(0))
                    }else{
                         f_den = parseInt((den/12).toFixed(0))
                        }
                    let gap = parseInt((f_den - num).toFixed(0))
                    dataToPlot.push({
                        name: "Gap",
                        y: gap,
                        color:"#7cb5ec"
                    })
                    if (dataToPlot[0].name = "Estimated Number of Pregnant Women"){
                        dataToPlot.shift()
                    }
                    if (dataToPlot[0].name = "MOH 711 New ANC clients"){
                       dataToPlot[0].name = "Results"
                       dataToPlot[0].color = "#434348"
                    }
                    console.log(dataToPlot)
                    drawPie('anc_target',cTitle,dataToPlot, periodName, fperiodName, curorg, null)
                    // p

                });

            }

            function getSyphilis(url){
                justFetch(url, {})
                .then(response => {
                    var cTitle = 'Proportion of pregnant women tested for Syphilis '
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;   
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    var periodName = []
                    var dataRows = []
                    var stacking = ''
                    let dataToPlot = []

                    dataValues = Array.from(response.rows, r => r[3])
                    const { rows } = response
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const getDXName = (id) => {
                        return response.metaData.items[id].name
                    }
                    const toNumbers = arr => arr.map(Number);
                    // console.log(pe)

                    dx.map((d_x,ix)=>{
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        datapoint.data = []
                        datapoint.type = 'column'
                        let da_ta
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x && rw1[response.headers.findIndex(jk => jk.name == "pe")] == p_e) || [0,0,0,0,0]
                            datapoint.data.push(parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ]))
                        })
                        
                        if (datapoint.name.toLowerCase().split(" ").join("_").includes("estimated_number_of_pregnant_women")) {
                                datapoint.data.map(data=>{
                                    if(pe[0].length == 6){
                                    da_ta = parseInt((data /12).toFixed(0))
                                    }else{
                                    da_ta = parseInt((data).toFixed(0))
                                    }
                                    datapoint.data.push(da_ta)
                                })
                             let len = parseInt(datapoint.data.length)/2
                                datapoint.data.splice(0,len)
                            }
                        dataToPlot.push(datapoint)
                        
                        
                    })
                     
                    console.log(dataToPlot)
                    var fperiodName = periodRange(periodName)
                    let den = dataToPlot.find(r=>r.name=="Estimated Number of Pregnant Women")?.data || 0
                    let num = dataToPlot.find(r=>r.name=="MOH 711 ANC clients tested for syphilis")?.data || 0
                    let Achieved =[]
                    num.map(dataa=>{
                        let f_archived = parseInt((dataa/den[0])*100)
                        Achieved.push(f_archived)
                    }) 
                    console.log(dataToPlot)
                    //  plotGraph(x_array, "Period", dataToPlot, "Proportions", "Proportion of IPTp missed opportunities referred to the Health Facility - "+response.metaData.items[response.metaData.dimensions.ou[0]].name, null, 'anc', "line", null)
                    drawSpines('syphilis', cTitle, periodName, fperiodName, curorg, dataToPlot, stacking,'', Achieved)

                });

            }
            function getSyphilis_target(url){
                justFetch(url, {})
                .then(response => {
                    var cTitle = 'Proportion of pregnant women tested for Syphilis '
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;   
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    var periodName = []
                    var dataRows = []
                    var stacking = ''
                    let dataToPlot = []
                    let finalData = []
                    finalData.name =[]
                    finalData.data = []
                    var color = ["#7cb5ec","#90ed7d","#434348"]

                    


                    dataValues = Array.from(response.rows, r => r[3])
                    const { rows } = response
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const getDXName = (id) => {
                        return response.metaData.items[id].name
                    }
                    const toNumbers = arr => arr.map(Number);
                    // console.log(pe)


                    dx.map((d_x,ix)=>{
                        
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x ) || [0,0,0,0,0]
                            datapoint.y = parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ])
                        })
                        
                        dataToPlot.push(datapoint)

                        
                        
                    })
                   
                    var fperiodName = periodRange(periodName)
                    let len = response.metaData.dimensions.pe.length
                    let f_den
                    let len_1 =  pe[0].length
                    let den = dataToPlot.find(r=>r.name=="Estimated Number of Pregnant Women")?.y || 0
                    let num = dataToPlot.find(r=>r.name=="MOH 711 ANC clients tested for syphilis")?.y || 0
                    
                    if (len_1 == 6){
                         f_den = parseInt(((len/12)*den).toFixed(0))
                    }else if(len_1 == 4){
                        f_den = parseInt((den).toFixed(0))
                    }else{
                         f_den = parseInt((den/12).toFixed(0))
                        }
                    let gap = parseInt((f_den - num).toFixed(0))
                    dataToPlot.push({
                        name: "Gap",
                        y: gap,
                        color:"#7cb5ec"
                    })
                    if (dataToPlot[0].name = "Estimated Number of Pregnant Women"){
                        dataToPlot.shift()
                    }
                    if (dataToPlot[0].name = "MOH 711 ANC clients tested for syphilis"){
                       dataToPlot[0].name = "Results"
                       dataToPlot[0].color = "#434348"
                    }
                    drawPie('syphilis_target',cTitle,dataToPlot, periodName, fperiodName, curorg, null)
                    // p

                });

            }
            function getHaart(url){
                justFetch(url, {})
                .then(response => {
                    var cTitle = 'Proportion of HIV infected pregnant and breastfeeding women on HAART '
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;   
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    var periodName = []
                    var dataRows = []
                    var stacking = ''
                    let dataToPlot = []

                    dataValues = Array.from(response.rows, r => r[3])
                    const { rows } = response
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const getDXName = (id) => {
                        return response.metaData.items[id].name
                    }
                    const toNumbers = arr => arr.map(Number);
                    // console.log(pe)

                    dx.map((d_x,ix)=>{
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        datapoint.data = []
                        datapoint.type = 'column'
                        let da_ta
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x && rw1[response.headers.findIndex(jk => jk.name == "pe")] == p_e) || [0,0,0,0,0]
                            datapoint.data.push(parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ]))
                        })
                        
                        if (datapoint.name.toLowerCase().split(" ").join("_").includes("Need for PMTCT (KP at 1st ANC + Newly Positive at ANC)")) {
                                datapoint.data.map(data=>{
                                    if(pe[0].length == 6){
                                    da_ta = parseInt((data /12).toFixed(0))
                                    }else{
                                    da_ta = parseInt((data).toFixed(0))
                                    }
                                    datapoint.data.push(da_ta)
                                })
                             let len = parseInt(datapoint.data.length)/2
                                datapoint.data.splice(0,len)
                            }
                        dataToPlot.push(datapoint)
                        
                        
                    })
                     
                    console.log(dataToPlot)
                    var fperiodName = periodRange(periodName)
                    let den = dataToPlot.find(r=>r.name=="Need for PMTCT (KP at 1st ANC + Newly Positive at ANC)")?.data || 0
                    let num = dataToPlot.find(r=>r.name=="Number on Maternal HAART")?.data || 0
                    let Achieved =[]
                    num.map(dataa=>{
                        let f_archived = parseInt((dataa/den[0])*100)
                        Achieved.push(f_archived)
                    }) 
                    //  plotGraph(x_array, "Period", dataToPlot, "Proportions", "Proportion of IPTp missed opportunities referred to the Health Facility - "+response.metaData.items[response.metaData.dimensions.ou[0]].name, null, 'anc', "line", null)
                    drawSpines('haart', cTitle, periodName, fperiodName, curorg, dataToPlot, stacking,'', Achieved)

                });

            }
            function getHaart_target(url){
                justFetch(url, {})
                .then(response => {
                    var cTitle = 'Proportion of HIV infected pregnant and breastfeeding women on HAART'
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;   
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    var periodName = []
                    var dataRows = []
                    var stacking = ''
                    let dataToPlot = []
                    let finalData = []
                    finalData.name =[]
                    finalData.data = []
                    var color = ["#7cb5ec","#90ed7d","#434348"]

                    


                    dataValues = Array.from(response.rows, r => r[3])
                    const { rows } = response
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const getDXName = (id) => {
                        return response.metaData.items[id].name
                    }
                    const toNumbers = arr => arr.map(Number);
                    // console.log(pe)


                    dx.map((d_x,ix)=>{
                        
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x ) || [0,0,0,0,0]
                            datapoint.y = parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ])
                        })
                        
                        dataToPlot.push(datapoint)

                        
                        
                    })
                   
                    var fperiodName = periodRange(periodName)
                    let len = response.metaData.dimensions.pe.length
                    let f_den
                    let len_1 =  pe[0].length
                    let den = dataToPlot.find(r=>r.name=="Need for PMTCT (KP at 1st ANC + Newly Positive at ANC)")?.y || 0
                    let num = dataToPlot.find(r=>r.name=="Number on Maternal HAART")?.y || 0
                    
                    if (len_1 == 6){
                         f_den = parseInt(((len/12)*den).toFixed(0))
                    }else if(len_1 == 4){
                        f_den = parseInt((den).toFixed(0))
                    }else{
                         f_den = parseInt((den/12).toFixed(0))
                        }
                    let gap = parseInt((f_den - num).toFixed(0))
                    dataToPlot.push({
                        name: "Gap",
                        y: gap,
                        color:"#7cb5ec"
                    })
                    if (dataToPlot[0].name = "Need for PMTCT (KP at 1st ANC + Newly Positive at ANC)"){
                        dataToPlot.shift()
                    }
                    if (dataToPlot[0].name = "Number on Maternal HAART"){
                       dataToPlot[0].name = "Results"
                       dataToPlot[0].color = "#434348"
                    }
                    drawPie('haart_target',cTitle,dataToPlot, periodName, fperiodName, curorg, null)
                    // p

                });

            }

            function getHei(url){
                justFetch(url, {})
                .then(response => {
                    var cTitle = 'Proportion of HIV Exposed Infants on Infant ARV Prophylaxis'
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;   
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    var periodName = []
                    var dataRows = []
                    var stacking = ''
                    let dataToPlot = []

                    dataValues = Array.from(response.rows, r => r[3])
                    const { rows } = response
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const getDXName = (id) => {
                        return response.metaData.items[id].name
                    }
                    const toNumbers = arr => arr.map(Number);
                    // console.log(pe)

                    dx.map((d_x,ix)=>{
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        datapoint.data = []
                        datapoint.type = 'column'
                        let da_ta
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x && rw1[response.headers.findIndex(jk => jk.name == "pe")] == p_e) || [0,0,0,0,0]
                            datapoint.data.push(parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ]))
                        })
                        
                        if (datapoint.name.toLowerCase().split(" ").join("_").includes("Need for PMTCT (KP at 1st ANC + Newly Positive at ANC)")) {
                                datapoint.data.map(data=>{
                                    if(pe[0].length == 6){
                                    da_ta = parseInt((data /12).toFixed(0))
                                    }else{
                                    da_ta = parseInt((data).toFixed(0))
                                    }
                                    datapoint.data.push(da_ta)
                                })
                             let len = parseInt(datapoint.data.length)/2
                                datapoint.data.splice(0,len)
                            }
                        dataToPlot.push(datapoint)
                        
                        
                    })
                     
                    console.log(dataToPlot)
                    var fperiodName = periodRange(periodName)
                    let den = dataToPlot.find(r=>r.name=="Need for PMTCT (KP at 1st ANC + Newly Positive at ANC)")?.data || 0
                    let num = dataToPlot.find(r=>r.name=="Started on Infant Prophylaxis in ANC, L&D and PNC")?.data || 0
                    let Achieved =[]
                    num.map(dataa=>{
                        let f_archived = parseInt((dataa/den[0])*100)
                        Achieved.push(f_archived)
                    }) 
                    //  plotGraph(x_array, "Period", dataToPlot, "Proportions", "Proportion of IPTp missed opportunities referred to the Health Facility - "+response.metaData.items[response.metaData.dimensions.ou[0]].name, null, 'anc', "line", null)
                    drawSpines('hei', cTitle, periodName, fperiodName, curorg, dataToPlot, stacking,'', Achieved)

                });

            }
            
            function getHei_target(url){
                justFetch(url, {})
                .then(response => {
                    var cTitle = 'Proportion of HIV Exposed Infants on Infant ARV Prophylaxis'
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;   
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    var periodName = []
                    var dataRows = []
                    var stacking = ''
                    let dataToPlot = []
                    let finalData = []
                    finalData.name =[]
                    finalData.data = []

                    


                    dataValues = Array.from(response.rows, r => r[3])
                    const { rows } = response
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const getDXName = (id) => {
                        return response.metaData.items[id].name
                    }
                    const toNumbers = arr => arr.map(Number);
                    // console.log(pe)


                    dx.map((d_x,ix)=>{
                        
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x ) || [0,0,0,0,0]
                            datapoint.y = parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ])
                        })
                        
                        dataToPlot.push(datapoint)

                        
                        
                    })
                   
                    var fperiodName = periodRange(periodName)
                    let len = response.metaData.dimensions.pe.length
                    let f_den
                    let len_1 =  pe[0].length
                    let den = dataToPlot.find(r=>r.name=="Need for PMTCT (KP at 1st ANC + Newly Positive at ANC)")?.y || 0
                    let num = dataToPlot.find(r=>r.name=="Started on Infant Prophylaxis in ANC, L&D and PNC")?.y || 0
                    
                    if (len_1 == 6){
                         f_den = parseInt(((len/12)*den).toFixed(0))
                    }else if(len_1 == 4){
                        f_den = parseInt((den).toFixed(0))
                    }else{
                         f_den = parseInt((den/12).toFixed(0))
                        }
                    let gap = parseInt((f_den - num).toFixed(0))
                    dataToPlot.push({
                        name: "Gap",
                        y: gap,
                        color:"#7cb5ec"
                    })
                    if (dataToPlot[0].name = "Need for PMTCT (KP at 1st ANC + Newly Positive at ANC)"){
                        dataToPlot.shift()
                    }
                    if (dataToPlot[0].name = "Started on Infant Prophylaxis in ANC, L&D and PNC"){
                       dataToPlot[0].name = "Results"
                       dataToPlot[0].color = "#434348"
                    }
                    drawPie('hei_target',cTitle,dataToPlot, periodName, fperiodName, curorg, null)
                    // p

                });

            }
            function getPcr(url){
                justFetch(url, {})
                .then(response => {
                    var cTitle = 'Percentage  of HIV Exposed infants receiving an initial PCR within 2 months of birth'
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;   
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    var periodName = []
                    var dataRows = []
                    var stacking = ''
                    let dataToPlot = []

                    dataValues = Array.from(response.rows, r => r[3])
                    const { rows } = response
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const getDXName = (id) => {
                        return response.metaData.items[id].name
                    }
                    const toNumbers = arr => arr.map(Number);
                    // console.log(pe)

                    dx.map((d_x,ix)=>{
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        datapoint.data = []
                        datapoint.type = 'column'
                        let da_ta
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x && rw1[response.headers.findIndex(jk => jk.name == "pe")] == p_e) || [0,0,0,0,0]
                            datapoint.data.push(parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ]))
                        })
                        
                        if (datapoint.name.toLowerCase().split(" ").join("_").includes("Need for PMTCT (KP at 1st ANC + Newly Positive at ANC)")) {
                                datapoint.data.map(data=>{
                                    if(pe[0].length == 6){
                                    da_ta = parseInt((data /12).toFixed(0))
                                    }else{
                                    da_ta = parseInt((data).toFixed(0))
                                    }
                                    datapoint.data.push(da_ta)
                                })
                             let len = parseInt(datapoint.data.length)/2
                                datapoint.data.splice(0,len)
                            }
                        dataToPlot.push(datapoint)
                        
                        
                    })
                     
                    console.log(dataToPlot)
                    var fperiodName = periodRange(periodName)
                    let den = dataToPlot.find(r=>r.name=="Need for PMTCT (KP at 1st ANC + Newly Positive at ANC)")?.data || 0
                    let num = dataToPlot.find(r=>r.name=="MOH 731  Initial PCR < 8wks       HV02-44")?.data || 0
                    let Achieved =[]
                    num.map(dataa=>{
                        let f_archived = parseInt((dataa/den[0])*100)
                        Achieved.push(f_archived)
                    }) 
                    //  plotGraph(x_array, "Period", dataToPlot, "Proportions", "Proportion of IPTp missed opportunities referred to the Health Facility - "+response.metaData.items[response.metaData.dimensions.ou[0]].name, null, 'anc', "line", null)
                    drawSpines('pcr', cTitle, periodName, fperiodName, curorg, dataToPlot, stacking,'', Achieved)

                });

            }
            
            function getPcr_target(url){
                justFetch(url, {})
                .then(response => {
                    var cTitle = 'Percentage  of HIV Exposed infants receiving an initial PCR within 2 months of birth'
                    var theorgunit = response.metaData.dimensions.ou[0];
                    var curorg = response.metaData.items[theorgunit].name;   
                    var dx = response.metaData.dimensions.dx;
                    var pe = response.metaData.dimensions.pe;
                    var periodName = []
                    var dataRows = []
                    var stacking = ''
                    let dataToPlot = []
                    let finalData = []
                    finalData.name =[]
                    finalData.data = []

                    


                    dataValues = Array.from(response.rows, r => r[3])
                    const { rows } = response
                    response.metaData.dimensions.pe.map(pe => {
                        periodName.push(response.metaData.items[pe].name)


                    })
                    const getDXName = (id) => {
                        return response.metaData.items[id].name
                    }
                    const toNumbers = arr => arr.map(Number);
                    // console.log(pe)


                    dx.map((d_x,ix)=>{
                        
                        let datapoint = {}
                        datapoint.name = response.metaData.items[d_x].name
                        pe.map(p_e=>{
                            let rw = response.rows.find(rw1=>rw1[response.headers.findIndex(jk => jk.name == "dx")] == d_x ) || [0,0,0,0,0]
                            datapoint.y = parseFloat(rw[
                                response.headers.findIndex(jk => jk.name == "value")
                            ])
                        })
                        
                        dataToPlot.push(datapoint)

                        
                        
                    })
                   
                    var fperiodName = periodRange(periodName)
                    let len = response.metaData.dimensions.pe.length
                    let f_den
                    let len_1 =  pe[0].length
                    let den = dataToPlot.find(r=>r.name=="Need for PMTCT (KP at 1st ANC + Newly Positive at ANC)")?.y || 0
                    let num = dataToPlot.find(r=>r.name=="MOH 731  Initial PCR < 8wks       HV02-44")?.y || 0
                    
                    if (len_1 == 6){
                         f_den = parseInt(((len/12)*den).toFixed(0))
                    }else if(len_1 == 4){
                        f_den = parseInt((den).toFixed(0))
                    }else{
                         f_den = parseInt((den/12).toFixed(0))
                        }
                    let gap = parseInt((f_den - num).toFixed(0))
                    dataToPlot.push({
                        name: "Gap",
                        y: gap,
                        color:"#7cb5ec"
                    })
                    if (dataToPlot[0].name = "Need for PMTCT (KP at 1st ANC + Newly Positive at ANC)"){
                        dataToPlot.shift()
                    }
                    if (dataToPlot[0].name = "MOH 731  Initial PCR < 8wks       HV02-44"){
                       dataToPlot[0].name = "Results"
                       dataToPlot[0].color = "#434348"
                    }
                    drawPie('pcr_target',cTitle,dataToPlot, periodName, fperiodName, curorg, null)
                    // p

                });

            }
        </script>
           
        <!-- ------------------------ PAGE DATA LOGIC ------------------------ -->
    </body>
</html>